angular.module("angularParseInterface",["ngResource"]).factory("parseInterface",["$rootScope","$resource","$log",function(a,b,c){"use strict";var d="signin",e="signout",f={};return f._resource=function(){var a={};return a._url=function(){var a="https://api.parse.com/1",b=function(a,b){return b.replace(/\/+$/,"")+"/"+a.replace(/^\/+/,"")};return{prependBaseUrl:function(c){return b(c,a)}}}(),a._headers=function(){var a=function(a,b){var c={"X-Parse-Application-Id":a.applicationId,"X-Parse-REST-API-Key":a.restKey};return b.sessionToken&&(c["X-Parse-Session-Token"]=b.sessionToken),c},b=function(b,c,d){return function(e,f){return angular.extend(f(),a(c,d)),b(e,f)}},c=function(a,b){var c=[].slice.call(arguments,2),d=a.transformRequest||function(a){return angular.toJson(a)};c.unshift(d),a.transformRequest=b.apply(null,c)};return{_parseRequestHeadersGetter:a,_wrapTransformRequest:b,_addHeadersForAction:c,addParseRequestHeaders:function(a,d,e){angular.forEach(a,function(a){c(a,b,d,e)})}}}(),a._dataEncoding=function(){var a=function(a,b,c){var d=a._getFieldDataType(b)||(angular.isDate(c)?"Date":void 0)||typeof c;return d[0].toUpperCase()+d.slice(1)},b=function(a,b,c){var d=a._getFieldDataType(b)||c&&c.__type||typeof c;return d[0].toUpperCase()+d.slice(1)},d=function(a,b){return a._isRequestBlacklisted(b)},e={Date:{encode:function(a,b,c){return{__type:"Date",iso:c.toISOString()}},decode:function(a,b,c){return new Date(c.iso)}},Pointer:{encode:function(a,b,d){var e,f=a._getFieldMetaDataProp(b,"className");return angular.isObject(d)?(c.warn("Objects in Pointer fields will not be automatically persisted; only their objectIds will besaved. If you want to save other data from those objects, you'll need to do so separately."),e=d.objectId,e||c.warn("No objectId found for object in Pointer field "+b+". Try saving it first.")):angular.isString(d)?e=d:c.warn("Could not find an objectId for Pointer field "+b+". Value in field should either be a string or an object."),{__type:"Pointer",className:f,objectId:e}},decode:function(a,b,c){var d=c.__type&&"Pointer"===c.__type;if(!d){var e=a._getFieldRelationConstructor(b);if(e)return new e(c)}return c.objectId}}},f=function(a){return e[a]&&e[a].encode||function(a,b,c){return c}},g=function(a){return e[a]&&e[a].decode||function(a,b,c){return c}};return{encodeRequestData:function(b,c){var e=a,g={};return angular.forEach(c,function(a,h){var i;d(b,h)||(i=f(e(b,h,a)),g[h]=i(b,h,c[h]))}),g},decodeResponseData:function(a,c){var d=b,e={};return angular.forEach(c,function(b,f){var h=g(d(a,f,b));e[f]=h(a,f,c[f])}),e}}}(),a.createAppResourceFactory=function(a,b,c,f){var g=this._url.prependBaseUrl.bind(this._url),h=this._headers.addParseRequestHeaders.bind(this._headers),i=this._dataEncoding.encodeRequestData.bind(this._dataEncoding),j=this._dataEncoding.decodeResponseData.bind(this._dataEncoding);return f.on(d,function(a,b){c.sessionToken=b.sessionToken}),f.on(e,function(){delete c.sessionToken}),function(d,e,f){var k,l,m={get:{method:"GET",transformResponse:function(a){return a=angular.fromJson(a),new k(j(k,a))}},query:{method:"GET",isArray:!0,transformResponse:function(a){var b=angular.fromJson(a).results;return b?angular.forEach(b,function(a,b,c){c[b]=new k(j(k,a))}):[]}},count:{method:"GET",isArray:!1,transformResponse:function(a){var b=angular.fromJson(a).count;return{count:b}}},create:{method:"POST",transformRequest:function(a){return angular.toJson(i(k,a))}},update:{method:"PUT",transformRequest:function(a){return angular.toJson(i(k,a))}},putData:{method:"PUT"},remove:{method:"DELETE"},"delete":{method:"DELETE"}},n=function(a){return a instanceof k},o=function(a){return"object"==typeof a&&!n(a)},p=function(a,b){for(var c=0,d=a.length;d>c;c++)if(b(a[c]))return a[c]},q=function(a,b){return p(angular.copy(a).reverse(),b)},r=function(a,b){return angular.forEach(b,function(c,d){a[d]=a[d]||b[d]}),a},s=function(a){var b={};return angular.forEach(a,function(a,c){angular.isFunction(a)||(b[c]=a)}),b};return l=angular.extend(m,f||{}),h(l,b,c),d=g(d),k=a(d,e,l),k.putData=function(){var a=k.putData;return function(){var b,c,d,e,f,g;return b=[].slice.call(arguments),c=p(b,o),d=p(b,n),e={objectId:d.objectId},f=p(b,angular.isFunction)||angular.noop,g=q(b,angular.isFunction)||angular.noop,g=g===f?angular.noop:g,a.call(this,e,c,f,g)}}(),k.query=function(){var a=k.query,b=k.count;return delete k.count,delete k.prototype.$count,function(){var c,d,e,f;return c=[].slice.call(arguments),d=p(c,o)||{},e=angular.equals(d.count,1),f=e?b:a,f.apply(this,c)}}(),k.save=function(){var a=k.create,b=k.update;return delete k.create,delete k.update,delete k.prototype.$create,delete k.prototype.$update,function(){var c,d,e,f,g,h,i,j,l,m;return c=[].slice.call(arguments),d=p(c,o)||{},e=p(c,n)||new k(d),f=s(e),g=angular.extend(f,d),i=p(c,angular.isFunction)||angular.noop,j=function(a,b){r(a,g),i(a,b)},h=q(c,angular.isFunction)||angular.noop,h=h===i?angular.noop:h,l=function(a){angular.extend(e,f),h(a)},m=e.isNew()?a:b,m.call(this,d,e,j,l)}}(),k._getMetaData=function(){return this._metaData||{}},k._setMetaData=function(a){this._metaData=a},k._getMetaDataProp=function(a){var b=this._getMetaData();return b[a]},k._setMetaDataProp=function(a,b){var c=this._getMetaData();c[a]=b,this._setMetaData(c)},k._getClassName=function(){return this._getMetaDataProp("className")},k._setClassName=function(a){return this._setMetaDataProp("className",a)},k._getFieldsMetaData=function(){return this._getMetaDataProp("fields")||{}},k._setFieldsMetaData=function(a){this._setMetaDataProp("fields",a)},k._getFieldMetaData=function(a){var b=this._getFieldsMetaData();return b[a]||{}},k._setFieldMetaData=function(a,b){var c=this._getFieldsMetaData();c[a]=b,this._setFieldsMetaData(c)},k._getFieldMetaDataProp=function(a,b){var c=this._getFieldMetaData(a);return c[b]},k._setFieldMetaDataProp=function(a,b,c){var d=this._getFieldMetaData(a);d[b]=c,this._setFieldMetaData(a,d)},k._getFieldDataType=function(a){return this._getFieldMetaDataProp(a,"dataType")},k._setFieldDataType=function(a,b){this._setFieldMetaDataProp(a,"dataType",b)},k._getFieldClassName=function(a){return this._getFieldMetaDataProp(a,"className")},k._setFieldClassName=function(a,b){this._setFieldMetaDataProp(a,"className",b)},k._getFieldRelationConstructor=function(a){return this._getFieldMetaDataProp(a,"relationConstructor")},k._setFieldRelationConstructor=function(a,b){return this._setFieldMetaDataProp(a,"relationConstructor",b)},k._addRequestBlacklistProp=function(a){this._setFieldMetaDataProp(a,"isRequestBlacklisted",!0)},k._addRequestBlacklistProps=function(){var a=angular.isArray(arguments[0])?arguments[0]:[].slice.call(arguments),b=this._addRequestBlacklistProp.bind(this);angular.forEach(a,b)},k._isRequestBlacklisted=function(a){return!!this._getFieldMetaDataProp(a,"isRequestBlacklisted")},k._addRequestBlacklistProps("createdAt","updatedAt"),k.hasOne=function(a,b){this._setFieldDataType(a,"Pointer"),this._setFieldClassName(a,b._getClassName()),this._setFieldRelationConstructor(a,b)},k.hasMany=function(a,b){this._setFieldDataType(a,"Relation"),this._setFieldClassName(a,b._getClassName())},k.prototype.isNew=function(){return!this.objectId},Object.defineProperty(k.prototype,"className",{get:function(){return this.constructor._getClassName()}}),k.prototype.getPointer=function(){return{__type:"Pointer",className:this.className,objectId:this.objectId}},k.prototype.setPointer=function(a,b){this[a]=b.objectId},k.prototype.addRelations=function(a){var b=angular.isArray(arguments[1])?arguments[1]:[].slice.call(arguments,1),c={};return c[a]={__op:"AddRelation",objects:[]},angular.forEach(b,function(b){c[a].objects.push(b.getPointer())}),this.$putData(c)},k.prototype.removeRelations=function(a){var b=angular.isArray(arguments[1])?arguments[1]:[].slice.call(arguments,1),c={};return c[a]={__op:"RemoveRelation",objects:[]},angular.forEach(b,function(b){c[a].objects.push(b.getPointer())}),this.$putData(c)},k.prototype.increment=function(a,b){return this[a]+=b,this.$save()},k.prototype.decrement=function(a,b){return this[a]-=b,this.$save()},k.prototype.deleteField=function(a){var b={},c=this;return b[a]={__op:"Delete"},this.$putData(b).then(function(){delete c[a]})},k.prototype._setPrivileges=function(a,b){this.ACL=this.ACL||{},this.ACL[a]=this.ACL[a]||{},b.read&&(this.ACL[a].read=b.read),b.write&&(this.ACL[a].write=b.write)},k.prototype.allCanRead=function(){this._setPrivileges("*",{read:!0})},k.prototype.allCanWrite=function(){this._setPrivileges("*",{write:!0})},k.prototype.setUserPrivileges=function(a,b){this._setPrivileges(a.objectId,b)},k}},a}(),f._query=function(){var a={},b=a.Query=function(a){this._Resource=a,this._params={}};return b.prototype._getConstraints=function(){return angular.copy(this._params.where)||{}},b.prototype._setConstraints=function(a){this._params.where=a},b.prototype._getFieldConstraints=function(a){var b=this._getConstraints();return angular.copy(b[a])},b.prototype._setFieldConstraints=function(a,b){var c=this._getConstraints();c[a]=b,this._setConstraints(c)},b.prototype._isNonArrayObj=function(a){return angular.isObject(a)&&!angular.isArray(a)},b.prototype._pick=function(a,b){var c={};return angular.forEach(a,function(a,d){~b.indexOf(d)&&(c[d]=a)}),c},b.prototype._setFieldConstraintsKey=function(a,b,c,d){var e=this._getFieldConstraints(a);return e=this._isNonArrayObj(e)?e:{},e=this._pick(e,d),e[b]=c,this._setFieldConstraints(a,e),this},b.prototype.equalTo=function(a,b){return this._setFieldConstraints(a,b),this},b.prototype.notEqualTo=function(a,b){var c=["$lt","$lte","$gt","$gte","$in","$nin","$exists","$select","$dontSelect","$inQuery","$notInQuery","$regex"];return this._setFieldConstraintsKey(a,"$ne",b,c),this},b.prototype.lessThan=function(a,b){var c=["$gt","$gte","$ne","$in","$nin","$select","$dontSelect","$inQuery","$notInQuery","$regex"];return this._setFieldConstraintsKey(a,"$lt",b,c),this},b.prototype.lessThanOrEqualTo=function(a,b){var c=["$gt","$gte","$ne","$in","$nin","$select","$dontSelect","$inQuery","$notInQuery","$regex"];return this._setFieldConstraintsKey(a,"$lte",b,c),this},b.prototype.greaterThan=function(a,b){var c=["$lt","$lte","$ne","$in","$nin","$select","$dontSelect","$inQuery","$notInQuery","$regex"];return this._setFieldConstraintsKey(a,"$gt",b,c),this},b.prototype.greaterThanOrEqualTo=function(a,b){var c=["$lt","$lte","$ne","$in","$nin","$select","$dontSelect","$inQuery","$notInQuery","$regex"];return this._setFieldConstraintsKey(a,"$gte",b,c),this},b.prototype.containedIn=function(a,b){var c=["$gt","$gte","$lt","$lte","$ne","$nin","$select","$dontSelect","$inQuery","$notInQuery","$regex"];return this._setFieldConstraintsKey(a,"$in",b,c),this},b.prototype.notContainedIn=function(a,b){var c=["$gt","$gte","$lt","$lte","$ne","$in","$select","$dontSelect","$inQuery","$notInQuery","$regex"];return this._setFieldConstraintsKey(a,"$nin",b,c),this},b.prototype.exists=function(a){var b=["$ne","$in","$nin","$select","$dontSelect","$inQuery","$notInQuery","$regex"];return this._setFieldConstraintsKey(a,"$exists",!0,b),this},b.prototype.doesNotExist=function(a){var b=[];return this._setFieldConstraintsKey(a,"$exists",!1,b),this},b.prototype.startsWith=function(a,b){var c=["$lt","$lte","$gt","$gte","$ne","$in","$nin","$exists","$select","$dontSelect","$inQuery","$notInQuery"],d="^\\Q"+b+"\\E";return this._setFieldConstraintsKey(a,"$regex",d,c),this},b.prototype.isRelationOf=function(a,b){var c=this._getConstraints();return c.$relatedTo={object:{__type:"Pointer",className:b.className,objectId:b.objectId},key:a},this._setConstraints(c),this},b.prototype.isRelatedTo=function(a,b){var c={__type:"Pointer",className:b.className,objectId:b.objectId};return this.equalTo(a,c),this},b.prototype.contains=function(a,b){return this._setFieldConstraints(a,b),this},b.prototype.containsAll=function(a,b){var c=["$lt","$lte","$gt","$gte","$ne","$in","$nin","$exists","$select","$dontSelect","$inQuery","$notInQuery","$regex"];return this._setFieldConstraintsKey(a,"$all",b,c),this},b.prototype.matchesQuery=function(a,b,c){var d=["$lt","$lte","$gt","$gte","$ne","$in","$nin","$exists","$select","$dontSelect","$notInQuery","$regex"];c=c||"objectId";var e={query:b._yieldParams(),key:c};return this._setFieldConstraintsKey(a,"$select",e,d),this},b.prototype.doesNotMatchQuery=function(a,b,c){var d=["$lt","$lte","$gt","$gte","$ne","$in","$nin","$exists","$select","$dontSelect","$inQuery","$regex"];c=c||"objectId";var e={query:b._yieldParams(),key:c};return this._setFieldConstraintsKey(a,"$dontSelect",e,d),this},b.or=function(a){var b=this,c=[].slice.call(arguments,1),d=new b(a),e=a._getClassName(),f=[];return angular.forEach(c,function(a){var b=a._yieldParams();b.className===e&&f.push(b.where)}),d._setConstraints({$or:f}),d},b.prototype.skip=function(a){return this._params.skip=a,this},b.prototype.limit=function(a){return this._params.limit=a,this},b.prototype.count=function(){return this._params.limit=0,this._params.count=1,this},b.prototype.select=function(){return this._params.keys=angular.isArray(arguments[0])?arguments[0]:[].slice.call(arguments),this},b.prototype.ascending=function(a){return this._params.order=this._params.order||[],this._params.order.push(a),this},b.prototype.descending=function(a){return this._params.order=this._params.order||[],this._params.order.push("-"+a),this},b.prototype.order=function(){return this._params.order=angular.isArray(arguments[0])?arguments[0]:[].slice.call(arguments),this},b.prototype._yieldParams=function(){var a=angular.copy(this._params);return a.order=a.order&&a.order.length&&a.order.join(","),a.include=a.include&&a.include.length&&a.include.join(","),a.className=this._Resource._getClassName(),a},b.prototype.exec=function(){var a=this._yieldParams();return delete a.className,a.where=a.where&&JSON.stringify(a.where),this._Resource.query(a)},a}(),f._object={_objectUrl:function(a){return"/classes/"+a+"/:objectId"},createObjectFactory:function(a){var b=this._objectUrl;return function(c,d,e){var f=b(c);e=e||{},d=angular.extend(d||{},{objectId:"@objectId"});var g=a(f,d,e);return g._setClassName(c),g}}},f._user=function(){return{_userUrl:"/:urlRoot/:objectId",_userDefaults:{urlRoot:"users",objectId:"@objectId"},_userDecorator:function(a,b,c){return a._setClassName("_User"),a._addRequestBlacklistProps("sessionToken","emailVerified"),a.signUp=function(a,e,f){var g=this.save({username:a,password:e,email:f});return g.$promise.then(function(){var a={sessionToken:g.sessionToken};delete g.sessionToken,c.emit(d,a)}),b.user=g},a.signIn=function(a,e){var f=this.get({urlRoot:"login",username:a,password:e});return f.$promise.then(function(){var a={sessionToken:f.sessionToken};delete f.sessionToken,c.emit(d,a)}),b.user=f},a.signOut=function(){delete b.user,c.emit(e)},a.current=function(){var a=b.user;return a||(a=this.get({objectId:"me"}),a.$promise.then(function(){b.sessionToken=a.sessionToken,delete a.sessionToken}),b.user=a),a},a},createUserModel:function(a,b,c){var d=this._userUrl,e=this._userDefaults,f={},g=a(d,e,f);return this._userDecorator(g,b,c)}}}(),f._eventBus={createEventBus:function(){var b=a.$new(!0),d=b.$on.bind(b),e=b.$emit.bind(b);return c.log(b.$on.bind),c.log(d),{on:d,emit:e}}},f.createAppInterface=function(a,c){c=c||{},c.parseApp=c.parseApp||{};var d=a.applicationId,e={},g=e._appStorage=c.parseApp[d]=c.parseApp[d]||{},h=e._eventBus=f._eventBus.createEventBus();return e._appResourceFactory=this._resource.createAppResourceFactory(b,a,g,h),e.objectFactory=this._object.createObjectFactory(e._appResourceFactory),e.User=this._user.createUserModel(e._appResourceFactory,g,h),e.Query=this._query.Query,e},f}]);